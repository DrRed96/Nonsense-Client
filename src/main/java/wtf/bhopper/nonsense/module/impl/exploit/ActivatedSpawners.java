package wtf.bhopper.nonsense.module.impl.exploit;

import net.minecraft.tileentity.TileEntity;
import net.minecraft.tileentity.TileEntityMobSpawner;
import net.minecraft.util.BlockPos;
import wtf.bhopper.nonsense.event.EventLink;
import wtf.bhopper.nonsense.event.Listener;
import wtf.bhopper.nonsense.event.impl.client.EventTick;
import wtf.bhopper.nonsense.event.impl.player.EventJoinGame;
import wtf.bhopper.nonsense.event.impl.render.EventRenderWorld;
import wtf.bhopper.nonsense.gui.hud.notification.Notification;
import wtf.bhopper.nonsense.gui.hud.notification.NotificationType;
import wtf.bhopper.nonsense.module.AbstractModule;
import wtf.bhopper.nonsense.module.ModuleCategory;
import wtf.bhopper.nonsense.module.ModuleInfo;
import wtf.bhopper.nonsense.module.property.impl.ColorProperty;
import wtf.bhopper.nonsense.util.render.ColorUtil;
import wtf.bhopper.nonsense.util.render.RenderUtil;

import java.util.ArrayList;
import java.util.List;

@ModuleInfo(name = "Activated Spawners",
        description = "lol funny 2b2t spawner hack.\n(Reveals activated mob spawners)",
        category = ModuleCategory.EXPLOIT)
public class ActivatedSpawners extends AbstractModule {

    private final ColorProperty color = new ColorProperty("Color", "Color of the spawners", ColorUtil.RED);

    private final List<BlockPos> spawners = new ArrayList<>();

    public ActivatedSpawners() {
        super();
        this.addProperties(this.color);
    }

    @EventLink
    public final Listener<EventJoinGame> onJoin = _ -> spawners.clear();

    @EventLink
    public final Listener<EventTick> onTick = _ -> {
        for (TileEntity entity : mc.theWorld.loadedTileEntityList) {
            if (entity instanceof TileEntityMobSpawner mobSpawner) {
                if (mobSpawner.getSpawnerBaseLogic().getSpawnDelay() != 20) {
                    BlockPos pos = entity.getPos();
                    if (!spawners.contains(pos)) {
                        spawners.add(pos);
                        Notification.send("Activated Spawners", "Activated spawner detected: " + pos.getX() + ", " + pos.getY() + ", " + pos.getZ(), NotificationType.INFO, 5000);
                    }
                }
            }
        }
    };

    @EventLink
    public final Listener<EventRenderWorld> onRender = _ -> {
        for (TileEntity entity : mc.theWorld.loadedTileEntityList) {
            if (entity instanceof TileEntityMobSpawner mobSpawner) {
                if (mobSpawner.getSpawnerBaseLogic().getSpawnDelay() != 20) {
                    RenderUtil.drawBlockBox(mobSpawner.getPos(), this.color.get(), true, true, 2.0F, false);
                }
            }
        }
    };

}
