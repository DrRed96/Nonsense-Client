package wtf.bhopper.nonsense.module.impl.exploit;

import net.minecraft.network.play.client.C17PacketCustomPayload;
import wtf.bhopper.nonsense.event.bus.EventLink;
import wtf.bhopper.nonsense.event.bus.Listener;
import wtf.bhopper.nonsense.event.impl.EventSendPacket;
import wtf.bhopper.nonsense.module.Module;
import wtf.bhopper.nonsense.module.ModuleCategory;
import wtf.bhopper.nonsense.module.ModuleInfo;
import wtf.bhopper.nonsense.module.property.annotations.DisplayName;
import wtf.bhopper.nonsense.module.property.impl.EnumProperty;
import wtf.bhopper.nonsense.util.minecraft.PacketUtil;

@ModuleInfo(name = "Client Spoofer",
        description = "Tricks the server into thinking you're using a specific client",
        category = ModuleCategory.EXPLOIT)
public class ClientSpoofer extends Module {

    private final EnumProperty<Client> client = new EnumProperty<>("Client", "Client to spoof as.", Client.LUNAR);

    public ClientSpoofer() {
        this.addProperties(this.client);
    }

    @EventLink
    public final Listener<EventSendPacket> onSendPacket = event -> {
        if (event.packet instanceof C17PacketCustomPayload packet) {
            if (packet.getChannelName().equals("MC|Brand")) {
                packet.setBufferData(switch (this.client.get()) {
                    case LUNAR -> {
                        packet.setChannel("REGISTER");
                        yield PacketUtil.createByteBuffer("Lunar-Client");
                    }
                    case FORGE -> PacketUtil.createStringBuffer("FML");
                    case PVP_LOUNGE -> PacketUtil.createByteBuffer("PLC18");
                    case CHEATBREAKER -> PacketUtil.createStringBuffer("CB");
                    case GEYSER -> PacketUtil.createByteBuffer("eyser");
                    case LABYMOD -> PacketUtil.createStringBuffer("LMC");
                });
            }
        }
    };

    @Override
    public String getSuffix() {
        return this.client.getDisplayValue();
    }

    private enum Client {
        LUNAR,
        FORGE,
        @DisplayName("PvP Lounge") PVP_LOUNGE,
        @DisplayName("CheatBreaker") CHEATBREAKER,
        GEYSER,
        @DisplayName("LabyMod") LABYMOD
    }

}
