package wtf.bhopper.nonsense.module.impl.exploit;

import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C10PacketCreativeInventoryAction;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;
import wtf.bhopper.nonsense.event.EventLink;
import wtf.bhopper.nonsense.event.Listener;
import wtf.bhopper.nonsense.event.impl.player.EventUpdate;
import wtf.bhopper.nonsense.gui.hud.notification.Notification;
import wtf.bhopper.nonsense.gui.hud.notification.NotificationType;
import wtf.bhopper.nonsense.module.Module;
import wtf.bhopper.nonsense.module.ModuleCategory;
import wtf.bhopper.nonsense.module.ModuleInfo;
import wtf.bhopper.nonsense.module.property.impl.BooleanProperty;
import wtf.bhopper.nonsense.module.property.impl.NumberProperty;
import wtf.bhopper.nonsense.util.minecraft.inventory.InventoryUtil;
import wtf.bhopper.nonsense.util.minecraft.inventory.ItemBuilder;
import wtf.bhopper.nonsense.util.minecraft.player.PacketUtil;
import wtf.bhopper.nonsense.util.misc.GeneralUtil;

@ModuleInfo(name = "Popbob",
        description = "malicious and evil hacking on 2b2t",
        category = ModuleCategory.EXPLOIT)
public class Popbob extends Module {

    private final NumberProperty amount = new NumberProperty("Amount", "How much to do the funny", 1.0, 1.0, 20.0, 1.0);
    private final BooleanProperty thing = new BooleanProperty("Throw", "Does funny stuff and things", false);

    public Popbob() {
        super();
        this.addProperties(this.amount, this.thing);
    }

    @EventLink
    public final Listener<EventUpdate> onUpdate = _ -> {
        if (!mc.thePlayer.capabilities.isCreativeMode) {
            this.toggle(false);
            Notification.send("Popbob", "You must be in creative mode to use the Popbob", NotificationType.ERROR, 3000);
            return;
        }

        Item item;
        do {
            item = Item.itemRegistry.getObject(GeneralUtil.randomElement(Item.itemRegistry.getKeys()));
        } while (item == null || item.getCreativeTab() == null);

        ItemStack stack = ItemBuilder.of(item)
                .setAmount(item.getItemStackLimit())
                .build();

        for (int i = 0; i < amount.getInt(); i++) {
            if (this.thing.get()) {
                PacketUtil.send(new C10PacketCreativeInventoryAction(InventoryUtil.HOTBAR_BEGIN + mc.thePlayer.inventory.currentItem, stack));
                PacketUtil.send(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.DROP_ALL_ITEMS, BlockPos.ORIGIN, EnumFacing.DOWN));
            } else {
                PacketUtil.send(new C10PacketCreativeInventoryAction(-1, stack));
            }
        }
    };

}
